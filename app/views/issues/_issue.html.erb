<% badgetype = "badge-primary" %>

<% case issue.status.downcase %>
<% when "new" %>
  <% badgetype = "badge-danger" %>
<% when "pending" %>
  <% badgetype = "badge-secondary" %>
<% when "resolved" %>
  <% badgetype = "badge-success" %>
<% end %>

<div class="card mb-3 mt-2", id="issue-<%=issue.id %>">
<div class = "card-body">
  <div class="card-title d-flex flex-column w-100">
    <div class="d-flex w-100 justify-content-between">
      <h5><%= link_to "Case# #{issue.id} : #{issue.issue_type}", issue %></h5>
      <div>
          <%if current_user %>
            <%= render 'issues/issue_dropdown', issue: issue %>
          <% end %>
      </div>
    </div>
    <div>   
      <span class="badge <%= badgetype %>">
        <%= issue.status %>
      </span>
      <small class = "text-muted">Sent by <%= link_to issue.customer.name, issue.customer %> <%= time_ago_in_words(issue.created_at)%> ago.</small>
    </div>
  </div>
  <div class = "d-flex flex-column">
    <div class="card-text mb-2 text-dark text-secondary">
      <%= "Game:  " if params[:controller] == "issues" %>
      <%= issue.title %>
    </div>
    <% if params[:controller] == "issues" %>
      <p class="mb-2 mt-2 lead"><strong>Issue Description:</strong> <%= issue.description %></p>
        <% if current_user && (current_user.admin? || current_user?(issue.customer)) %>
          <div class = "d-flex justify-content-center mt-2 border-top pt-2">
            <%= link_to "Escalate", "#", class:"btn btn-warning m-1" %>
            <%= link_to "Mark As Resolved", "#", class:"btn btn-success m-1" %>  
            <%= link_to "Edit", edit_issue_path(issue), class:"btn btn-primary m-1" %>   
            <%= link_to "Delete", issue, method: :delete, data: { confirm: "Are you sure? Confirming will permanently delete the case." }, class:"btn btn-danger m-1" %>   
          </div>
        <% end %>
    <% end %>
  </div>
</div>
</div>